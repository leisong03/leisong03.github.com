---
typora-copy-images-to: ../images
---

# 二轮车调试内部手册



## 接线

一共有两个电机口，分别是左轮电机和右轮电机

| 板上电机端口 | AGV功能链接 |      | 备注                                                         |
| ------------ | ----------- | ---- | ------------------------------------------------------------ |
| Y电机端口    | 左轮驱动    |      | 1,Y_EN(EN)，2,Y_MS1（PG）,3,Y_MS2（空）,4,Y_SV（SV）,5,Y_ST（BK）,6, Y_DIR（FR）, |
| Z电机端口    | 右轮驱动    |      | 1,Z_EN(EN)，2,Z_MS1（PG）,3,Z_MS2（空）, 4,Z_SV（SV）, 5,Z_ST（BK）, 6,Z_DIR（FR）, |
| E0~E1        | CAN+USART3  |      | E1_STEP(USART3_TX),E1_DIR(USART3_RX),E0_DIR(CAN_RX),E1_EN(CAN_TX) |
| USART1       | 接秤板      |      |                                                              |
| USART2       | 接超声板    |      | CHL_A,B,C,D 分别指对应通道的探测数据，在30CM-250CM 间，数据 0x06 表示距离 30CM，数据 0x07 表示距离 35CM，
数据 0x08 表示距离 40CM，...数据 0x32 表示距离 250CM。盲区 0-30CM,
用数据 0x01 表示。250CM 内无障碍物，用数据 0x7F 表示。用数据 0x80 表
示无探头。常温下可能会有 0x04,0x05 等数据，表示 20CM,25CM; |

板子上需要做两处修改：

1. 焊接掉C299
2. R403短接或者换0欧

![image-20181105101647603](../images/image-20181105101647603.png)

## 控制方法程序


## 协议

###PC->STM32

包有效时间为2秒，超过两秒会停车且不刹车

| Byte  | Param | Describe | Type  |  Range   |       Unit |
| ----- | ----- | :------: | :---: | :------: | ---------: |
| Byte0 | 包头  |   0x68   | uint8 |          |            |
| Byte1 | 左轮  |   速度   | int8  | -127~127 | 归一化速度 |
| Byte2 | 右轮  |   速度   | int8  | -127~127 | 归一化速度 |
| Byte3 | out1  | 开关状态 | uin8  |  0或者1  |            |
| Byte4 | 包尾  |   0xFF   | uint8 |          |            |

###Stm32->PC

| Byte           | Param    |  Describe  |  Type   |  Range   |       Unit |
| -------------- | -------- | :--------: | :-----: | :------: | ---------: |
| Byte0          | 包头     |    0x68    |  uint8  |          |            |
| Byte1~Byte2    | 左圈里程 |    里程    | Int16_t |  stepA   |            |
| Byte3~byte4    | 右圈里程 |    里程    | int16_t |  stepB   |            |
| Byte5          | 左圈速度 |    速度    |  Int8   | -127~127 | 归一化速度 |
| Byte6          | 右圈速度 |    速度    |  Int8   | -127~127 | 归一化速度 |
| Byte7          | out1状态 |    状态    |  uint8  |  0或者1  |            |
| Byte8～Byte15  | 超声     |  超声距离  |  uint8  |   注1    |            |
| Byte16～Byte17 | 重量     |    重量    | uint16  |          |            |
| Byte18~Byte19  | 电量     |            |         | 0～4096  | 归一化电量 |
| Byte20         | 充电状态 | xmin的状态 |         |   0和1   |            |
| Byte21         | 包尾     |    0xFF    |  uint8  |          |            |

注1:CHL_A,B,C,D 分别指对应通道的探测数据，在30CM-250CM 间，数据 0x06 表示距离 30CM，数据 0x07 表示距离 35CM，数据 0x08 表示距离 40CM，...数据 0x32 表示距离 250CM。盲区 0-30CM,用数据 0x01 表示。250CM 内无障碍物，用数据 0x7F 表示。用数据 0x80 表示无探头。常温下可能会有 0x04,0x05 等数据，表示 20CM,25CM;

### 物理协议

#### rs232

波特率为9600，8N1

#### CAN

波特率为125Kbps