# 帮团售货柜控制协议

## 概述

控制器共包括如下套件

| 部件     | 数量   | 备注            |
| ------ | ---- | ------------- |
| 舵机     | 4    | 均为180度舵机      |
| 光学碰撞开关 | 3    |               |
| 磁性碰撞开关 | 3    |               |
| USB摄像头 | 1    | UVC摄像头        |
| USB网卡  | 1    | RTL8152       |
| 热敏电阻   | 1    |               |
| 继电器板   | 1    | 控制压缩机         |
| 喇叭     | 1    | 通过运放          |
| 麦克风    | 1    | 单mic          |
| 7寸屏幕   | 1    | 调试用（一批发货只配一个） |
| LED输出  | 6    |               |

## 硬件接线

<TBD>

## 通讯协议

从I2C总线走，所以无需包头包尾和校验位

### 控制包 A33->STM32

总包长 13

| 编号           | 数据类型    | 项目            | 备注                                      |
| ------------ | ------- | ------------- | --------------------------------------- |
| Byte0        | uint8_t | seq           | 序列号：0～255                               |
| Byte1        | uint8_t | Type          | 包类型：0                                   |
| Byte2～Byte5  | uint8_t | sweeperPos[4] | 舵机值：0～255<br />对应1～2ms输出<br />对应0～180角度 |
| Byte6~Byte11 | uint8_t | outVal[6]     | out1到out6的输出值：0～255                     |
| Byte12       | int16   | ExtTargetTemp | 外置温控器目标温度：-300～300                      |

### 状态包 STM32->A33

| 编号            | 数据类型     | 项目            | 备注                  |
| ------------- | -------- | ------------- | ------------------- |
| Byte0         | uint8_t  | seq           | 序列号：0～255           |
| Byte1         | uint8_t  | Type          | 包类型：1               |
| Byte2~Byte9   | uint16_t | ADCValue[4]   | 传感器值: 0~4095        |
| Byte10～Byte11 | int16_t  | ThermalCouple | 热电偶温度值：-300～300     |
| Byte12～Byte13 | int16_t  | ExtCurTemp    | 外置温控器当前温度：-300～300  |
| Byte14～Byte17 | uint8_t  | sweeperPos[4] | 舵机当前值：0～255         |
| Byte18~Byte21 | uint8_t  | outVal[4]     | out1到out6的当前值：0～255 |
| Byte22        | uint8_t  | hitWall       | 碰撞开关状态              |


byte 22的bit格式
| 7        | 6        | 5    | 4    | 3    | 2    | 1    | 0    |
| -------- | -------- | ---- | ---- | ---- | ---- | ---- | ---- |
| reserved | reserved | Zmax | Zmin | Ymax | Ymin | XMAX | XMin |



## 控制界面

<TBD>